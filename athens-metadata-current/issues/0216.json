{
  "url":"https://api.github.com/repos/athensresearch/athens/issues/216",
  "repository_url":"https://api.github.com/repos/athensresearch/athens",
  "labels_url":"https://api.github.com/repos/athensresearch/athens/issues/216/labels{/name}",
  "comments_url":"https://api.github.com/repos/athensresearch/athens/issues/216/comments",
  "events_url":"https://api.github.com/repos/athensresearch/athens/issues/216/events",
  "html_url":"https://github.com/athensresearch/athens/pull/216",
  "id":650975243,
  "node_id":"MDExOlB1bGxSZXF1ZXN0NDQ0MzQxMjg3",
  "number":216,
  "title":"Debug datascript",
  "user":{
    "login":"tangjeff0",
    "id":8952138,
    "node_id":"MDQ6VXNlcjg5NTIxMzg=",
    "avatar_url":"https://avatars1.githubusercontent.com/u/8952138?v=4",
    "gravatar_id":"",
    "url":"https://api.github.com/users/tangjeff0",
    "html_url":"https://github.com/tangjeff0",
    "followers_url":"https://api.github.com/users/tangjeff0/followers",
    "following_url":"https://api.github.com/users/tangjeff0/following{/other_user}",
    "gists_url":"https://api.github.com/users/tangjeff0/gists{/gist_id}",
    "starred_url":"https://api.github.com/users/tangjeff0/starred{/owner}{/repo}",
    "subscriptions_url":"https://api.github.com/users/tangjeff0/subscriptions",
    "organizations_url":"https://api.github.com/users/tangjeff0/orgs",
    "repos_url":"https://api.github.com/users/tangjeff0/repos",
    "events_url":"https://api.github.com/users/tangjeff0/events{/privacy}",
    "received_events_url":"https://api.github.com/users/tangjeff0/received_events",
    "type":"User",
    "site_admin":false
  },
  "labels":[],
  "state":"closed",
  "locked":false,
  "assignee":null,
  "assignees":[],
  "milestone":null,
  "created_at":"2020-07-05 00:17:35 UTC",
  "updated_at":"2020-07-05 00:19:45 UTC",
  "closed_at":"2020-07-05 00:19:45 UTC",
  "author_association":"MEMBER",
  "active_lock_reason":null,
  "pull_request":{
    "url":"https://api.github.com/repos/athensresearch/athens/pulls/216",
    "html_url":"https://github.com/athensresearch/athens/pull/216",
    "diff_url":"https://github.com/athensresearch/athens/pull/216.diff",
    "patch_url":"https://github.com/athensresearch/athens/pull/216.patch"
  },
  "body":"https://github.com/tonsky/datascript/issues/315\r\n\r\nMany issues here, mainly to do with asynchronous `dispatch`es, routing, and resetting the datascript and re-frame dbs. Not a normal bug, as it's probably rare to reset these two database in an app. My poorly written code elsewhere probably didn't help, namely with routing and me not realizing that resetting app-db would reset the routing as well. But the stack trace for the pull API was incredibly difficult to go through, and the resetting of the DB might've had non-deterministic behavior due to the nature of dispatches? Not sure here, maybe I'm just trying to blame other people.\r\n\r\nThe code that led to the problem mainly:\r\n\r\n```\r\n\r\n(defn daily-notes-panel\r\n  []\r\n  (let [note-refs (subscribe [:daily-notes])]\r\n    (fn []\r\n      (when (empty? @note-refs)\r\n        (dispatch [:next-daily-note (get-day)]))\r\n      (let [eids (q '[:find [?e ...]\r\n                      :in $ [?uid ...]\r\n                      :where [?e :block/uid ?uid]]\r\n                   db/dsdb\r\n                   @note-refs)]\r\n        (prn \"EIDS\" @eids)\r\n        (when (not-empty @eids)\r\n          (prn \"REFS\" @note-refs)\r\n          (let [notes (pull-many db/dsdb\r\n                        '[*]\r\n                        (map (fn [x] [:block/uid x]) @note-refs))] ;; <----\r\n            (prn \"notes\" @notes)\r\n            [:div#daily-notes (use-style daily-notes-scroll-area-style)\r\n             (doall\r\n               (for [{:keys [block/uid]} @notes]\r\n                 ^{:key uid}\r\n                 [:<>\r\n                  [:div (use-style daily-notes-page-style)\r\n                   [node-page-component [:block/uid uid]]]]))\r\n             [:div (use-style daily-notes-notional-page-style)\r\n              [:h1 \"Earlier\"]]]))))))\r\n\r\n```",
  "performed_via_github_app":null
}
