{
  "url":"https://api.github.com/repos/athensresearch/athens/issues/105",
  "repository_url":"https://api.github.com/repos/athensresearch/athens",
  "labels_url":"https://api.github.com/repos/athensresearch/athens/issues/105/labels{/name}",
  "comments_url":"https://api.github.com/repos/athensresearch/athens/issues/105/comments",
  "events_url":"https://api.github.com/repos/athensresearch/athens/issues/105/events",
  "html_url":"https://github.com/athensresearch/athens/pull/105",
  "id":627576669,
  "node_id":"MDExOlB1bGxSZXF1ZXN0NDI1MzU4ODM2",
  "number":105,
  "title":"feat(parsing): basic support for URL links",
  "user":{
    "login":"roryokane",
    "id":79168,
    "node_id":"MDQ6VXNlcjc5MTY4",
    "avatar_url":"https://avatars0.githubusercontent.com/u/79168?v=4",
    "gravatar_id":"",
    "url":"https://api.github.com/users/roryokane",
    "html_url":"https://github.com/roryokane",
    "followers_url":"https://api.github.com/users/roryokane/followers",
    "following_url":"https://api.github.com/users/roryokane/following{/other_user}",
    "gists_url":"https://api.github.com/users/roryokane/gists{/gist_id}",
    "starred_url":"https://api.github.com/users/roryokane/starred{/owner}{/repo}",
    "subscriptions_url":"https://api.github.com/users/roryokane/subscriptions",
    "organizations_url":"https://api.github.com/users/roryokane/orgs",
    "repos_url":"https://api.github.com/users/roryokane/repos",
    "events_url":"https://api.github.com/users/roryokane/events{/privacy}",
    "received_events_url":"https://api.github.com/users/roryokane/received_events",
    "type":"User",
    "site_admin":false
  },
  "labels":[],
  "state":"closed",
  "locked":false,
  "assignee":null,
  "assignees":[],
  "milestone":null,
  "created_at":"2020-05-29 22:23:18 UTC",
  "updated_at":"2020-06-04 11:00:51 UTC",
  "closed_at":"2020-05-30 19:54:01 UTC",
  "author_association":"CONTRIBUTOR",
  "active_lock_reason":null,
  "pull_request":{
    "url":"https://api.github.com/repos/athensresearch/athens/pulls/105",
    "html_url":"https://github.com/athensresearch/athens/pull/105",
    "diff_url":"https://github.com/athensresearch/athens/pull/105.diff",
    "patch_url":"https://github.com/athensresearch/athens/pull/105.patch"
  },
  "body":"This PR is a draft because it’s built on top of the commits in PR #102. That PR must be reviewed and merged first. Only the commit “feat(parsing): basic support for URL links” is new to this PR.\r\n\r\n## Before\r\n\r\n![Athens before support for parsing URL links](https://user-images.githubusercontent.com/79168/83310392-dc0c7300-a1d9-11ea-838f-33329921418b.png)\r\n\r\n## After\r\n\r\n![Athens after support for parsing URL links](https://user-images.githubusercontent.com/79168/83310396-e0389080-a1d9-11ea-8db1-3aea4460d41c.png)",
  "performed_via_github_app":null,
  "comments":[
    {
      "url":"https://api.github.com/repos/athensresearch/athens/issues/comments/636372148",
      "html_url":"https://github.com/athensresearch/athens/pull/105#issuecomment-636372148",
      "issue_url":"https://api.github.com/repos/athensresearch/athens/issues/105",
      "id":636372148,
      "node_id":"MDEyOklzc3VlQ29tbWVudDYzNjM3MjE0OA==",
      "user":{
        "login":"roryokane",
        "id":79168,
        "node_id":"MDQ6VXNlcjc5MTY4",
        "avatar_url":"https://avatars0.githubusercontent.com/u/79168?v=4",
        "gravatar_id":"",
        "url":"https://api.github.com/users/roryokane",
        "html_url":"https://github.com/roryokane",
        "followers_url":"https://api.github.com/users/roryokane/followers",
        "following_url":"https://api.github.com/users/roryokane/following{/other_user}",
        "gists_url":"https://api.github.com/users/roryokane/gists{/gist_id}",
        "starred_url":"https://api.github.com/users/roryokane/starred{/owner}{/repo}",
        "subscriptions_url":"https://api.github.com/users/roryokane/subscriptions",
        "organizations_url":"https://api.github.com/users/roryokane/orgs",
        "repos_url":"https://api.github.com/users/roryokane/repos",
        "events_url":"https://api.github.com/users/roryokane/events{/privacy}",
        "received_events_url":"https://api.github.com/users/roryokane/received_events",
        "type":"User",
        "site_admin":false
      },
      "created_at":"2020-05-30 19:10:23 UTC",
      "updated_at":"2020-05-30 19:10:23 UTC",
      "author_association":"CONTRIBUTOR",
      "body":"There’s a [big diff for src/cljs/athens/parse_renderer.cljs](https://github.com/athensresearch/athens/pull/105/files#diff-6ea7ebf6c619a31ac6d0d18ee63b12b3) only because I reindented the map values due to the maximum key length changing. All I changed was renaming `:block-link` to `:page-link` and adding the `:url-link` transform.\r\n\r\nI know reindenting like that causes big diffs, but I don’t see any Clojure-style-compatible way to avoid that. I tried avoiding it by formatting the transform rules like this, but I think this looks ugly:\r\n\r\n~~~clj\r\n(defn transform\r\n  \"Transforms Instaparse output to Hiccup.\"\r\n  [tree]\r\n  (insta/transform\r\n    {:block\r\n     , (fn [& contents]\r\n         (concat [:span {:class \"block\"}] contents))\r\n     :page-link \r\n     , (fn [title]\r\n         (let [id (subscribe [:block/uid [:node/title title]])]\r\n           [:span {:class \"page-link\"}\r\n            [:span {:style {:color \"gray\"}} \"[[\"]\r\n            [:a {:href  (rfee/href :page {:id (:block/uid @id)})\r\n                 :style {:text-decoration \"none\" :color \"dodgerblue\"}} title]\r\n            [:span {:style {:color \"gray\"}} \"]]\"]]))\r\n     :block-ref\r\n     , (fn [id]\r\n         (let [string (subscribe [:block/string [:block/uid id]])]\r\n           [:span {:class \"block-ref\"\r\n                   :style {:font-size \"0.9em\" :border-bottom \"1px solid gray\"}}\r\n            [:a {:href (rfee/href :page {:id id})} (parse-and-render (:block/string @string))]]))\r\n     :hashtag\r\n     , (fn [tag-name]\r\n         (let [id (subscribe [:block/uid [:node/title tag-name]])]\r\n           [:a {:class \"hashtag\"\r\n                :style {:color \"gray\" :text-decoration \"none\" :font-weight \"bold\"}\r\n                :href  (rfee/href :page {:id (:block/uid @id)})}\r\n            (str \"#\" tag-name)]))\r\n     :url-link\r\n     , (fn [{url :url} text]\r\n         [:a {:class \"url-link\"\r\n              :href url}\r\n          text])\r\n     :bold\r\n     , (fn [text]\r\n         [:strong {:class \"bold\"} text])}\r\n    tree))\r\n~~~\r\n\r\nAnd extra padding (extra spaces after keys) made the code look worse than just enough padding (one space after the longest key):\r\n\r\n~~~clj\r\n(defn transform\r\n  \"Transforms Instaparse output to Hiccup.\"\r\n  [tree]\r\n  (insta/transform\r\n    {:block       (fn [& contents]\r\n                    (concat [:span {:class \"block\"}] contents))\r\n     :page-link   (fn [title]\r\n                    (let [id (subscribe [:block/uid [:node/title title]])]\r\n                      [:span {:class \"page-link\"}\r\n                       [:span {:style {:color \"gray\"}} \"[[\"]\r\n                       [:a {:href  (rfee/href :page {:id (:block/uid @id)})\r\n                            :style {:text-decoration \"none\" :color \"dodgerblue\"}} title]\r\n                       [:span {:style {:color \"gray\"}} \"]]\"]]))\r\n     :block-ref   (fn [id]\r\n                    (let [string (subscribe [:block/string [:block/uid id]])]\r\n                      [:span {:class \"block-ref\"\r\n                              :style {:font-size \"0.9em\" :border-bottom \"1px solid gray\"}}\r\n                       [:a {:href (rfee/href :page {:id id})} (parse-and-render (:block/string @string))]]))\r\n     :hashtag     (fn [tag-name]\r\n                    (let [id (subscribe [:block/uid [:node/title tag-name]])]\r\n                      [:a {:class \"hashtag\"\r\n                           :style {:color \"gray\" :text-decoration \"none\" :font-weight \"bold\"}\r\n                           :href  (rfee/href :page {:id (:block/uid @id)})}\r\n                       (str \"#\" tag-name)]))\r\n     :url-link    (fn [{url :url} text]\r\n                    [:a {:class \"url-link\"\r\n                         :href url}\r\n                     text])\r\n     :bold        (fn [text]\r\n                    [:strong {:class \"bold\"} text])}\r\n    tree))\r\n~~~",
      "performed_via_github_app":null
    },
    {
      "url":"https://api.github.com/repos/athensresearch/athens/issues/comments/636376250",
      "html_url":"https://github.com/athensresearch/athens/pull/105#issuecomment-636376250",
      "issue_url":"https://api.github.com/repos/athensresearch/athens/issues/105",
      "id":636376250,
      "node_id":"MDEyOklzc3VlQ29tbWVudDYzNjM3NjI1MA==",
      "user":{
        "login":"jeroenvandijk",
        "id":27645,
        "node_id":"MDQ6VXNlcjI3NjQ1",
        "avatar_url":"https://avatars1.githubusercontent.com/u/27645?v=4",
        "gravatar_id":"",
        "url":"https://api.github.com/users/jeroenvandijk",
        "html_url":"https://github.com/jeroenvandijk",
        "followers_url":"https://api.github.com/users/jeroenvandijk/followers",
        "following_url":"https://api.github.com/users/jeroenvandijk/following{/other_user}",
        "gists_url":"https://api.github.com/users/jeroenvandijk/gists{/gist_id}",
        "starred_url":"https://api.github.com/users/jeroenvandijk/starred{/owner}{/repo}",
        "subscriptions_url":"https://api.github.com/users/jeroenvandijk/subscriptions",
        "organizations_url":"https://api.github.com/users/jeroenvandijk/orgs",
        "repos_url":"https://api.github.com/users/jeroenvandijk/repos",
        "events_url":"https://api.github.com/users/jeroenvandijk/events{/privacy}",
        "received_events_url":"https://api.github.com/users/jeroenvandijk/received_events",
        "type":"User",
        "site_admin":false
      },
      "created_at":"2020-05-30 19:53:47 UTC",
      "updated_at":"2020-05-30 19:53:47 UTC",
      "author_association":"CONTRIBUTOR",
      "body":"@roryokane Thanks for thinking about explaining the diff. I wouldn't have been confident merging it otherwise.",
      "performed_via_github_app":null
    },
    {
      "url":"https://api.github.com/repos/athensresearch/athens/issues/comments/636388960",
      "html_url":"https://github.com/athensresearch/athens/pull/105#issuecomment-636388960",
      "issue_url":"https://api.github.com/repos/athensresearch/athens/issues/105",
      "id":636388960,
      "node_id":"MDEyOklzc3VlQ29tbWVudDYzNjM4ODk2MA==",
      "user":{
        "login":"roryokane",
        "id":79168,
        "node_id":"MDQ6VXNlcjc5MTY4",
        "avatar_url":"https://avatars0.githubusercontent.com/u/79168?v=4",
        "gravatar_id":"",
        "url":"https://api.github.com/users/roryokane",
        "html_url":"https://github.com/roryokane",
        "followers_url":"https://api.github.com/users/roryokane/followers",
        "following_url":"https://api.github.com/users/roryokane/following{/other_user}",
        "gists_url":"https://api.github.com/users/roryokane/gists{/gist_id}",
        "starred_url":"https://api.github.com/users/roryokane/starred{/owner}{/repo}",
        "subscriptions_url":"https://api.github.com/users/roryokane/subscriptions",
        "organizations_url":"https://api.github.com/users/roryokane/orgs",
        "repos_url":"https://api.github.com/users/roryokane/repos",
        "events_url":"https://api.github.com/users/roryokane/events{/privacy}",
        "received_events_url":"https://api.github.com/users/roryokane/received_events",
        "type":"User",
        "site_admin":false
      },
      "created_at":"2020-05-30 21:42:02 UTC",
      "updated_at":"2020-05-30 21:42:02 UTC",
      "author_association":"CONTRIBUTOR",
      "body":"I found a good solution for reviewing indentation changes in the future. In GitHub’s “Files changed” view, click the Gear menu at the top, check “Hide whitespace changes”, and click “Apply and reload”. This is the discoverable way to [add `?w=1` to the URL](https://github.com/athensresearch/athens/pull/105/files?w=1), which, as you can see, hides whitespace-only changes in diffs.",
      "performed_via_github_app":null
    }
  ]
}
